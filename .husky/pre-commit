#!/usr/bin/env sh

echo "🔍 Running pre-commit quality checks..."
echo "========================================"

# Track start time
start_time=$(date +%s)

# Function to run command with error handling
run_check() {
  echo ""
  echo "$1"
  echo "----------------------------------------"

  if $2; then
    echo "✅ PASSED"
    return 0
  else
    echo "❌ FAILED"
    echo ""
    echo "🔧 To fix automatically:"
    echo "   npm run $3"
    echo ""
    return 1
  fi
}

# Auto-format code first
echo ""
echo "🎨 Auto-formatting code with Prettier..."
echo "----------------------------------------"
if npm run format; then
  echo "✅ Code formatted successfully"
else
  echo "⚠️  Formatting completed with warnings"
fi

# Run ESLint
run_check "📝 Checking code quality with ESLint..." "npm run lint" "lint:fix"

# Run Prettier check
run_check "🎨 Checking code formatting with Prettier..." "npm run format:check" "format"

# Run TypeScript type checking
run_check "🔧 Checking TypeScript types..." "npm run type-check" "type-check"

# Calculate duration
end_time=$(date +%s)
duration=$((end_time - start_time))

echo ""
echo "========================================"
echo "🎉 All pre-commit checks passed! ($duration seconds)"
echo "========================================"
