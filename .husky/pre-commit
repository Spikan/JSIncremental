#!/usr/bin/env sh

echo "ğŸ” Running pre-commit quality checks..."
echo "========================================"

# Track start time
start_time=$(date +%s)

# Function to run command with error handling
run_check() {
  echo ""
  echo "$1"
  echo "----------------------------------------"

  if $2; then
    echo "âœ… PASSED"
    return 0
  else
    echo "âŒ FAILED"
    echo ""
    echo "ğŸ”§ To fix automatically:"
    echo "   npm run $3"
    echo ""
    return 1
  fi
}

# Auto-format code first
echo ""
echo "ğŸ¨ Auto-formatting code with Prettier..."
echo "----------------------------------------"
if npm run format; then
  echo "âœ… Code formatted successfully"
else
  echo "âš ï¸  Formatting completed with warnings"
fi

# Run ESLint
run_check "ğŸ“ Checking code quality with ESLint..." "npm run lint" "lint:fix"

# Run Prettier check
run_check "ğŸ¨ Checking code formatting with Prettier..." "npm run format:check" "format"

# Run TypeScript type checking
run_check "ğŸ”§ Checking TypeScript types..." "npm run type-check" "type-check"

# Calculate duration
end_time=$(date +%s)
duration=$((end_time - start_time))

echo ""
echo "========================================"
echo "ğŸ‰ All pre-commit checks passed! ($duration seconds)"
echo "========================================"
