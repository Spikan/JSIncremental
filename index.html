<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <title>Soda Clicker Pro - Modern UI</title>
    <meta name="description" content="Soda Clicker Pro - The Ultimate Soda Drinking Experience" />
    <meta name="author" content="Spikan" />

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#001789" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Soda Clicker Pro" />
    <meta name="msapplication-TileColor" content="#001789" />
    <meta name="msapplication-tap-highlight" content="no" />

    <!-- Manifest -->
    <link rel="manifest" href="/manifest.webmanifest" />

    <!-- Modern CSS System (replaces 50,000+ lines of legacy CSS) -->
    <link rel="stylesheet" type="text/css" href="css/index.css" />

    <!-- Icons -->
    <link rel="icon" href="images/favicon.ico" sizes="any" />
    <link rel="apple-touch-icon" href="images/apple-touch-icon-180x180.png" />

    <!-- External Dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/break_eternity.js@2.1.2/dist/break_eternity.min.js"></script>
    <script src="https://unpkg.com/zod@3.22.4/lib/index.umd.js"></script>
    <script
      type="module"
      src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"
    ></script>

    <script>
      // Error handling
      (function () {
        try {
          window.__diag = Array.isArray(window.__diag) ? window.__diag : [];
          window.addEventListener('error', function (e) {
            try {
              window.__diag.push({ type: 'error', msg: e.message, src: e.filename, ln: e.lineno });
            } catch {}
          });
          window.addEventListener('unhandledrejection', function (e) {
            try {
              var r = e && e.reason;
              window.__diag.push({
                type: 'unhandledrejection',
                reason: (r && (r.message || r)) + '',
              });
            } catch {}
          });
        } catch {}
      })();

      // Game initialization
      window.addEventListener('load', function () {
        console.log('✅ Modern UI loaded, TypeScript will handle initialization');
      });
    </script>
  </head>
  <body class="theme-beach">
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
      <div class="loading-spinner"></div>
      <div class="loading-text">Loading Soda Clicker Pro...</div>
    </div>

    <!-- Main Game Content -->
    <div id="gameContent" class="game-content" style="display: none">
      <!-- Modern Game Header -->
      <header class="soda-drinker-header" id="sodaDrinkerHeader">
        <div class="header-main-content">
          <!-- Level Display -->
          <div class="level-display-section">
            <div class="level-polygon-container hover-lift">
              <div class="level-polygon">
                <span class="level-number" id="levelNumber">1</span>
              </div>
              <div class="level-info-minimal">
                <div class="level-name-minimal" id="currentLevelName">THE BEACH</div>
                <div class="unlock-requirements" id="unlockRequirements">
                  <div class="requirement-text text-xs">Next: 100 sips, 25 clicks</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Currency Display -->
          <div class="currency-display-section">
            <div class="currency-polygon-main hover-scale">
              <div class="currency-icon-polygon">💧</div>
              <div class="currency-value-main" id="topSipValue">0</div>
              <div class="currency-label-main">SIPS</div>
            </div>
            <div class="secondary-stats-minimal">
              <div class="stat-polygon hover-lift" id="sipsPerDrinkStat">
                <span class="stat-value" id="topSipsPerDrink">1</span>
                <span class="stat-label">/DRINK</span>
              </div>
              <div class="stat-polygon hover-lift" id="sipsPerSecondStat">
                <span class="stat-value" id="topSipsPerSecond">1</span>
                <span class="stat-label">/SEC</span>
              </div>
            </div>
          </div>

          <!-- Controls -->
          <div class="controls-section">
            <button class="control-polygon" data-action="openSettings" aria-label="Open Settings">
              <span class="control-icon">⚙</span>
            </button>
            <button class="control-polygon" id="mobileMenuToggle" aria-label="Toggle Menu">
              <span class="control-icon">☰</span>
            </button>
          </div>
        </div>

        <!-- Fountain Panel -->
        <div id="fountainPanel" class="fountain-panel"></div>

        <!-- PWA Indicators -->
        <div class="pwa-indicators">
          <div id="offline-indicator" class="offline-indicator" style="display: none">
            📴 Offline - Game continues with cached data
          </div>
          <button id="pwa-install-button" class="pwa-install-button" style="display: none">
            📱 Install App
          </button>
        </div>
      </header>

      <!-- Main Game Content -->
      <main id="mainGameContent" class="main-game-content">
        <!-- Main Content Area -->
        <section class="main-content-area">
          <!-- Soda Clicking Section -->
          <div class="soda-main-section">
            <div class="soda-container">
              <button
                id="sodaButton"
                data-action="sodaClick"
                data-args="1"
                class="soda-button hover-scale will-change-transform"
                role="button"
                tabindex="0"
                aria-label="Click to drink soda"
              >
                <img
                  src="images/regSoda.png"
                  alt="a picture of soda for you to click"
                  class="soda-fallback"
                />
              </button>
              <div class="click-indicator" id="clickIndicator">
                <div class="click-ripple"></div>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons stagger-in">
              <button class="suction-btn hover-lift" data-action="buySuction">
                <div class="suction-icon">💨</div>
                <div class="suction-info">
                  <div class="suction-name">Suction</div>
                  <div class="suction-cost"><span id="suctionCost">40</span> Sips</div>
                </div>
                <div class="suction-effect">
                  <div class="click-power-display">
                    <span class="click-power-label">Click Power:</span>
                    <span class="click-power-value" id="clickValue">1.0</span>
                  </div>
                  <div class="suction-bonus">
                    +<span id="suctionClickBonus">1.0</span> per click
                  </div>
                </div>
              </button>

              <button
                class="suction-btn hover-lift"
                data-action="buyFasterDrinks"
                aria-label="Buy Faster Drinks"
              >
                <div class="suction-icon">⚡</div>
                <div class="suction-info">
                  <div class="suction-name">Faster Drinks</div>
                  <div class="suction-cost"><span id="fasterDrinksCost">200</span> Sips</div>
                </div>
                <div class="suction-effect">
                  <div class="click-power-display">
                    <span class="click-power-label">Drink Time:</span>
                    <span class="click-power-value" id="currentDrinkSpeed">5.00s</span>
                  </div>
                  <div class="suction-bonus">
                    <span id="drinkSpeedBonusCompact">0%</span> faster
                  </div>
                </div>
              </button>
            </div>
          </div>
        </section>

        <!-- Sidebar -->
        <aside class="game-sidebar">
          <div class="card">
            <div class="card-header">
              <h2 class="card-title">Shop</h2>
              <button class="btn btn-ghost" id="sidebarCloseBtn" aria-label="Close Shop">
                <span class="close-icon">×</span>
              </button>
            </div>

            <div class="stagger-in">
              <!-- Straw Production -->
              <div class="upgrade-card hover-lift">
                <div class="upgrade-header">
                  <div class="upgrade-icon">🥤</div>
                  <div class="upgrade-info">
                    <h4 class="upgrade-name">Extra Straw</h4>
                    <p class="upgrade-description">Generate sips per drink</p>
                  </div>
                </div>
                <button class="upgrade-btn" data-action="buyStraw">
                  <span class="upgrade-cost"><span id="strawCost">5</span> Sips</span>
                  <span>Buy</span>
                </button>
                <div class="upgrade-stats">
                  <div class="upgrade-owned">Owned: <span id="straws">0</span></div>
                  <div class="upgrade-effect">+<span id="strawSPD">0</span> per drink</div>
                </div>
              </div>

              <!-- Cup Production -->
              <div class="upgrade-card hover-lift">
                <div class="upgrade-header">
                  <div class="upgrade-icon">☕</div>
                  <div class="upgrade-info">
                    <h4 class="upgrade-name">Bigger Cup</h4>
                    <p class="upgrade-description">Higher capacity production</p>
                  </div>
                </div>
                <button class="upgrade-btn" data-action="buyCup">
                  <span class="upgrade-cost"><span id="cupCost">15</span> Sips</span>
                  <span>Buy</span>
                </button>
                <div class="upgrade-stats">
                  <div class="upgrade-owned">Owned: <span id="cups">0</span></div>
                  <div class="upgrade-effect">+<span id="cupSPD">0</span> per drink</div>
                </div>
              </div>

              <!-- Wider Straws Enhancement -->
              <div class="upgrade-card hover-lift enhancement">
                <div class="upgrade-header">
                  <div class="upgrade-icon">🔧</div>
                  <div class="upgrade-info">
                    <h4 class="upgrade-name">Wider Straws</h4>
                    <p class="upgrade-description">Enhance straw efficiency</p>
                  </div>
                </div>
                <button class="upgrade-btn" data-action="buyWiderStraws">
                  <span class="upgrade-cost"><span id="widerStrawsCost">150</span> Sips</span>
                  <span>Buy</span>
                </button>
                <div class="upgrade-stats">
                  <div class="upgrade-owned">Owned: <span id="widerStraws">0</span></div>
                  <div class="upgrade-effect">+<span id="widerStrawsSPD">0</span>% boost</div>
                </div>
              </div>

              <!-- Better Cups Enhancement -->
              <div class="upgrade-card hover-lift enhancement">
                <div class="upgrade-header">
                  <div class="upgrade-icon">🔧</div>
                  <div class="upgrade-info">
                    <h4 class="upgrade-name">Better Cups</h4>
                    <p class="upgrade-description">Enhance cup efficiency</p>
                  </div>
                </div>
                <button class="upgrade-btn" data-action="buyBetterCups">
                  <span class="upgrade-cost"><span id="betterCupsCost">400</span> Sips</span>
                  <span>Buy</span>
                </button>
                <div class="upgrade-stats">
                  <div class="upgrade-owned">Owned: <span id="betterCups">0</span></div>
                  <div class="upgrade-effect">+<span id="betterCupsSPD">0</span>% boost</div>
                </div>
              </div>
            </div>
          </div>
        </aside>
      </main>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="settings-modal" style="display: none">
      <div class="modal-overlay" data-action="closeSettings">
        <div class="settings-modal-content" onclick="event.stopPropagation()">
          <div class="settings-modal-header">
            <h2 class="settings-modal-title">
              <span class="settings-icon">⚙️</span>
              Settings & Statistics
            </h2>
            <button
              class="settings-modal-close"
              data-action="closeSettings"
              aria-label="Close Settings"
            >
              <span class="close-icon">×</span>
            </button>
          </div>

          <!-- Tab Navigation -->
          <div class="settings-modal-tabs">
            <button
              class="settings-tab-btn active"
              data-tab="settings"
              data-action="switchSettingsTab"
              data-args="settings"
            >
              <span class="tab-icon">⚙️</span>
              <span class="tab-label">Settings</span>
            </button>
            <button
              class="settings-tab-btn"
              data-tab="levels"
              data-action="switchSettingsTab"
              data-args="levels"
            >
              <span class="tab-icon">🎮</span>
              <span class="tab-label">Levels</span>
            </button>
            <button
              class="settings-tab-btn"
              data-tab="statistics"
              data-action="switchSettingsTab"
              data-args="statistics"
            >
              <span class="tab-icon">📊</span>
              <span class="tab-label">Statistics</span>
            </button>
          </div>

          <div class="settings-modal-body">
            <!-- Settings Tab -->
            <div class="settings-tab-content active" id="settings-tab">
              <div class="settings-group">
                <h4 class="settings-group-title">Audio</h4>
                <div class="audio-control">
                  <label for="masterVolumeSlider">🔊 Master Volume</label>
                  <div class="volume-slider-container">
                    <input
                      type="range"
                      id="masterVolumeSlider"
                      class="volume-slider"
                      min="0"
                      max="100"
                      value="70"
                      step="5"
                    />
                    <span id="masterVolumeValue" class="volume-value">70%</span>
                  </div>
                </div>
                <div class="audio-control">
                  <label for="sfxVolumeSlider">🔔 SFX Volume</label>
                  <div class="volume-slider-container">
                    <input
                      type="range"
                      id="sfxVolumeSlider"
                      class="volume-slider"
                      min="0"
                      max="100"
                      value="60"
                      step="5"
                    />
                    <span id="sfxVolumeValue" class="volume-value">60%</span>
                  </div>
                </div>
                <button
                  id="buttonSoundsToggle"
                  data-action="toggleButtonSounds"
                  class="settings-btn"
                >
                  🔊 Button Sounds ON
                </button>
              </div>

              <div class="settings-group">
                <h4 class="settings-group-title">Save & Load</h4>
                <button data-action="save" class="settings-btn btn-primary">Save Game</button>
                <button data-action="delete_save" class="settings-btn btn-secondary">
                  Delete Save
                </button>
              </div>
            </div>

            <!-- Statistics Tab -->
            <div class="settings-tab-content" id="statistics-tab">
              <div class="settings-group">
                <h4 class="settings-group-title">Game Statistics</h4>
                <div class="stats-grid">
                  <div class="stat-card">
                    <div class="stat-icon">👆</div>
                    <div class="stat-content">
                      <p class="stat-label">Total Clicks</p>
                      <p class="stat-value" id="totalClicks">0</p>
                    </div>
                  </div>
                  <div class="stat-card">
                    <div class="stat-icon">⏰</div>
                    <div class="stat-content">
                      <p class="stat-label">Play Time</p>
                      <p class="stat-value" id="totalPlayTime">0:00:00</p>
                    </div>
                  </div>
                  <div class="stat-card">
                    <div class="stat-icon">💧</div>
                    <div class="stat-content">
                      <p class="stat-label">Total Sips</p>
                      <p class="stat-value" id="totalSipsEarned">0</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- TypeScript Entry Point -->
    <script type="module" src="ts/index.ts"></script>

    <script>
      // Initialize modern UI enhancements
      document.addEventListener('DOMContentLoaded', function () {
        // Hide loading screen after content loads
        setTimeout(() => {
          const loadingScreen = document.getElementById('loadingScreen');
          const gameContent = document.getElementById('gameContent');

          if (loadingScreen) {
            loadingScreen.style.opacity = '0';
            setTimeout(() => {
              loadingScreen.style.display = 'none';
              if (gameContent) {
                gameContent.style.display = 'block';
                gameContent.style.opacity = '0';
                requestAnimationFrame(() => {
                  gameContent.style.transition = 'opacity 0.5s ease-out';
                  gameContent.style.opacity = '1';
                });
              }
            }, 300);
          }
        }, 1000);

        // Add theme transition effects
        let currentTheme = 'theme-beach';

        // Authentic SDP theme switching (integrate with your hybrid level system)
        window.switchTheme = function (newTheme) {
          document.body.classList.add('theme-transition');
          document.body.classList.remove(currentTheme);
          document.body.classList.add(newTheme);
          currentTheme = newTheme;

          setTimeout(() => {
            document.body.classList.remove('theme-transition');
          }, 500);
        };

        // Example: Switch to different authentic SDP levels
        // Available: theme-beach, theme-park, theme-weird-room, theme-space,
        // theme-castle, theme-mouth, theme-convention, theme-empty-pool,
        // theme-dark-woods, theme-county-fair

        // Add click ripple effects
        document.addEventListener('click', function (e) {
          const button = e.target.closest('.btn, .suction-btn, .upgrade-btn, .soda-button');
          if (button && !button.disabled) {
            const ripple = document.createElement('div');
            const rect = button.getBoundingClientRect();
            const size = Math.max(rect.width, rect.height);
            const x = e.clientX - rect.left - size / 2;
            const y = e.clientY - rect.top - size / 2;

            ripple.className = 'click-ripple';
            ripple.style.cssText = `
              width: ${size}px;
              height: ${size}px;
              left: ${x}px;
              top: ${y}px;
            `;

            button.style.position = 'relative';
            button.style.overflow = 'hidden';
            button.appendChild(ripple);

            setTimeout(() => {
              if (ripple.parentNode) {
                ripple.parentNode.removeChild(ripple);
              }
            }, 700);
          }
        });

        console.log('✅ Modern UI initialized with enhanced interactions');
      });
    </script>
  </body>
</html>
