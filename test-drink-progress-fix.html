<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drink Progress Bar Fix Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #001789; color: white; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #00B36B; border-radius: 8px; }
        .success { color: #00D97F; }
        .warning { color: #FF8E53; }
        .error { color: #FF3D02; }
        .progress-test { margin: 20px 0; }
        .drink-progress-container { width: 300px; height: 30px; background: #333; border-radius: 6px; overflow: hidden; border: 1px solid #00B36B; }
        .drink-progress-fill { height: 100%; background: linear-gradient(90deg, #00B36B, #00D97F); width: 0%; transition: width 0.2s ease; border-radius: 6px; }
        .drink-progress-fill.progress-complete { background: linear-gradient(90deg, #FF3D02, #FF6B6B); box-shadow: 0 0 20px rgba(255, 61, 2, 0.6); }
        .countdown { margin-top: 10px; font-size: 18px; }
        .countdown.countdown-warning { color: #FF3D02; font-weight: bold; animation: countdownPulse 0.5s ease-in-out infinite alternate; }
        @keyframes countdownPulse { 0% { opacity: 1; } 100% { opacity: 0.5; } }
    </style>
</head>
<body>
    <h1>üß™ Drink Progress Bar Fix Test</h1>
    
    <div class="test-section">
        <h2>üîç Dependency Status Check</h2>
        <div id="dependency-status"></div>
    </div>
    
    <div class="test-section">
        <h2>üéØ Progress Bar Functionality Test</h2>
        <div class="progress-test">
            <div class="drink-progress-container">
                <div class="drink-progress-fill" id="testProgressFill"></div>
            </div>
            <div class="countdown" id="testCountdown">5.0s</div>
        </div>
        <button onclick="testProgressBar()">Test Progress Bar</button>
        <button onclick="testCountdown()">Test Countdown</button>
        <div id="progress-test-results"></div>
    </div>
    
    <div class="test-section">
        <h2>‚öôÔ∏è Game Logic Test</h2>
        <div id="game-logic-results"></div>
    </div>
    
    <script>
        const results = document.getElementById('dependency-status');
        const progressResults = document.getElementById('progress-test-results');
        const gameLogicResults = document.getElementById('game-logic-results');
        
        // Test dependency availability
        function checkDependencies() {
            let html = '';
            
            const dependencies = [
                { name: 'FEATURE_UNLOCKS', check: () => typeof FEATURE_UNLOCKS !== 'undefined' },
                { name: 'DOM_CACHE', check: () => typeof DOM_CACHE !== 'undefined' },
                { name: 'GAME_CONFIG', check: () => typeof window.GAME_CONFIG !== 'undefined' },
                { name: 'App object', check: () => typeof window.App !== 'undefined' },
                { name: 'updateDrinkProgress function', check: () => typeof window.App?.ui?.updateDrinkProgress === 'function' }
            ];
            
            dependencies.forEach(dep => {
                if (dep.check()) {
                    html += `<div class="success">‚úÖ ${dep.name} is available</div>`;
                } else {
                    html += `<div class="error">‚ùå ${dep.name} is NOT available</div>`;
                }
            });
            
            results.innerHTML = html;
        }
        
        // Test progress bar functionality
        function testProgressBar() {
            const progressFill = document.getElementById('testProgressFill');
            const countdown = document.getElementById('testCountdown');
            
            let progress = 0;
            const interval = setInterval(() => {
                progress += 2;
                if (progress <= 100) {
                    progressFill.style.width = `${progress}%`;
                    
                    if (progress >= 100) {
                        progressFill.classList.add('progress-complete');
                        countdown.textContent = '0.0s';
                        countdown.classList.add('countdown-warning');
                    }
                } else {
                    clearInterval(interval);
                    setTimeout(() => {
                        progressFill.classList.remove('progress-complete');
                        countdown.classList.remove('countdown-warning');
                        progressFill.style.width = '0%';
                        countdown.textContent = '5.0s';
                    }, 1000);
                }
            }, 100);
            
            progressResults.innerHTML = '<div class="success">‚úÖ Progress bar test completed - check visual feedback above</div>';
        }
        
        // Test countdown functionality
        function testCountdown() {
            const countdown = document.getElementById('testCountdown');
            let timeLeft = 5.0;
            
            const interval = setInterval(() => {
                timeLeft -= 0.1;
                if (timeLeft > 0) {
                    countdown.textContent = `${timeLeft.toFixed(1)}s`;
                    if (timeLeft <= 1.0) {
                        countdown.classList.add('countdown-warning');
                    }
                } else {
                    clearInterval(interval);
                    countdown.textContent = '0.0s';
                    countdown.classList.add('countdown-warning');
                    
                    setTimeout(() => {
                        countdown.classList.remove('countdown-warning');
                        countdown.textContent = '5.0s';
                    }, 1000);
                }
            }, 100);
            
            progressResults.innerHTML = '<div class="success">‚úÖ Countdown test completed - check visual feedback above</div>';
        }
        
        // Test game logic
        function testGameLogic() {
            let html = '<h3>Game Logic Validation:</h3>';
            
            try {
                // Test if drink progress calculation works
                const testDrinkRate = 5000; // 5 seconds
                const testTimeSinceLastDrink = 2500; // 2.5 seconds
                const expectedProgress = (testTimeSinceLastDrink / testDrinkRate) * 100;
                
                html += `<div class="success">‚úÖ Progress calculation: ${testTimeSinceLastDrink}ms / ${testDrinkRate}ms = ${expectedProgress.toFixed(1)}%</div>`;
                
                // Test if progress clamping works
                const clampedProgress = Math.min(Math.max(expectedProgress, 0), 100);
                html += `<div class="success">‚úÖ Progress clamping: ${expectedProgress.toFixed(1)}% ‚Üí ${clampedProgress.toFixed(1)}%</div>`;
                
                // Test countdown calculation
                const remainingTime = Math.max(0, testDrinkRate - (expectedProgress / 100 * testDrinkRate));
                const remainingSeconds = (remainingTime / 1000).toFixed(1);
                html += `<div class="success">‚úÖ Countdown calculation: ${remainingSeconds}s remaining</div>`;
                
            } catch (error) {
                html += `<div class="error">‚ùå Error in game logic test: ${error.message}</div>`;
            }
            
            gameLogicResults.innerHTML = html;
        }
        
        // Run all tests
        window.addEventListener('load', () => {
            setTimeout(() => {
                checkDependencies();
                testGameLogic();
            }, 1000);
        });
    </script>
</body>
</html>