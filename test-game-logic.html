<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Game Logic Test</title>
    <style>
      body {
        margin: 0;
        padding: 20px;
        font-family: Arial, sans-serif;
        background: #001789;
        color: white;
      }
      .test-container {
        max-width: 1200px;
        margin: 0 auto;
      }
      .test-section {
        background: rgba(255, 255, 255, 0.1);
        padding: 20px;
        margin: 20px 0;
        border-radius: 10px;
      }
      .test-button {
        background: #ff3d02;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
      }
      .test-button:hover {
        background: #e63500;
      }
      .test-button.success {
        background: #28a745;
      }
      .test-button.error {
        background: #dc3545;
      }
      .test-button.warning {
        background: #ffc107;
        color: black;
      }
      .status {
        padding: 10px;
        margin: 10px 0;
        border-radius: 5px;
      }
      .status.success {
        background: rgba(40, 167, 69, 0.2);
      }
      .status.error {
        background: rgba(220, 53, 69, 0.2);
      }
      .status.warning {
        background: rgba(255, 193, 7, 0.2);
        color: black;
      }
      .status.info {
        background: rgba(0, 123, 255, 0.2);
      }
      .tab-navigation {
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
        margin-bottom: 20px;
      }
      .tab-btn {
        background: #333;
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 5px;
        cursor: pointer;
      }
      .tab-btn.active {
        background: #ff3d02;
      }
      .tab-content {
        display: none;
      }
      .tab-content.active {
        display: block;
      }
      .console-output {
        background: black;
        color: lime;
        padding: 10px;
        border-radius: 5px;
        font-family: monospace;
        height: 300px;
        overflow-y: auto;
        margin: 10px 0;
      }
      .game-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 10px;
        margin: 10px 0;
      }
      .stat-item {
        background: rgba(255, 255, 255, 0.05);
        padding: 10px;
        border-radius: 5px;
      }
    </style>
  </head>
  <body>
    <div class="test-container">
      <h1>üéÆ Game Logic Test Suite</h1>

      <div class="test-section">
        <h2>üîß System Status</h2>
        <div id="system-status"></div>
        <button class="test-button" onclick="checkSystemStatus()">Check System Status</button>
        <button class="test-button" onclick="initializeGameSystems()">
          Initialize Game Systems
        </button>
      </div>

      <div class="test-section">
        <h2>üéØ Core Functionality Tests</h2>
        <button class="test-button" onclick="testSodaClick()">Test Soda Click</button>
        <button class="test-button" onclick="testTabSwitching()">Test Tab Switching</button>
        <button class="test-button" onclick="testButtonSystem()">Test Button System</button>
        <button class="test-button" onclick="testGameLoop()">Test Game Loop</button>
      </div>

      <div class="test-section">
        <h2>üìä Game Statistics</h2>
        <div id="game-stats" class="game-stats"></div>
        <button class="test-button" onclick="updateGameStats()">Update Stats</button>
      </div>

      <div class="test-section">
        <h2>üéÆ Game Interface</h2>
        <div class="tab-navigation">
          <button class="tab-btn active" data-action="switchTab:soda">ü•§ Soda</button>
          <button class="tab-btn" data-action="switchTab:shop">üõí Shop</button>
          <button class="tab-btn" data-action="switchTab:stats">üìä Stats</button>
          <button class="tab-btn" data-action="switchTab:options">‚öôÔ∏è Options</button>
        </div>

        <div id="sodaTab" class="tab-content active">
          <h3>ü•§ Soda Clicking</h3>
          <button id="sodaButton" class="test-button" data-action="sodaClick">Click Soda!</button>
          <p>Click the button above to test soda clicking functionality.</p>
        </div>

        <div id="shopTab" class="tab-content">
          <h3>üõí Shop</h3>
          <button class="test-button" data-action="buyStraw">Buy Straw (5 sips)</button>
          <button class="test-button" data-action="buyCup">Buy Cup (15 sips)</button>
          <p>Test purchase functionality.</p>
        </div>

        <div id="statsTab" class="tab-content">
          <h3>üìä Statistics</h3>
          <div id="stats-content">
            <p>Statistics will be displayed here when the tab is active.</p>
          </div>
        </div>

        <div id="optionsTab" class="tab-content">
          <h3>‚öôÔ∏è Options</h3>
          <label> <input type="checkbox" data-action="toggleAutosave" /> Enable Autosave </label>
          <br />
          <label>
            <input type="checkbox" data-action="toggleButtonSounds" /> Enable Button Sounds
          </label>
        </div>
      </div>

      <div class="test-section">
        <h2>üìù Console Output</h2>
        <div id="console-output" class="console-output"></div>
        <button class="test-button" onclick="clearConsole()">Clear Console</button>
      </div>
    </div>

    <script>
      // Capture console output
      const originalLog = console.log;
      const originalError = console.error;
      const originalWarn = console.warn;

      function addToConsole(type, ...args) {
        const output = document.getElementById('console-output');
        const timestamp = new Date().toLocaleTimeString();
        const message = `[${timestamp}] [${type}] ${args.join(' ')}`;
        output.innerHTML += message + '<br>';
        output.scrollTop = output.scrollHeight;
      }

      console.log = (...args) => {
        originalLog.apply(console, args);
        addToConsole('LOG', ...args);
      };

      console.error = (...args) => {
        originalError.apply(console, args);
        addToConsole('ERROR', ...args);
      };

      console.warn = (...args) => {
        originalWarn.apply(console, args);
        addToConsole('WARN', ...args);
      };

      function addStatus(elementId, message, type = 'info') {
        const element = document.getElementById(elementId);
        element.innerHTML = `<div class="status ${type}">${message}</div>`;
      }

      function checkSystemStatus() {
        console.log('üîç Checking system status...');

        const checks = [
          { name: 'App Object', check: () => !!window.App },
          { name: 'App.state', check: () => !!window.App?.state },
          { name: 'App.ui', check: () => !!window.App?.ui },
          { name: 'App.systems', check: () => !!window.App?.systems },
          { name: 'App.events', check: () => !!window.App?.events },
          { name: 'DOM_CACHE', check: () => !!window.DOM_CACHE },
          { name: 'initGame Function', check: () => typeof window.initGame === 'function' },
          { name: 'startGame Function', check: () => typeof window.startGame === 'function' },
          {
            name: 'switchTab Function',
            check: () => typeof window.App?.ui?.switchTab === 'function',
          },
          {
            name: 'handleSodaClick Function',
            check: () => typeof window.App?.systems?.clicks?.handleSodaClick === 'function',
          },
          {
            name: 'Button System',
            check: () => typeof window.App?.ui?.initButtonSystem === 'function',
          },
          {
            name: 'Game Loop',
            check: () => typeof window.App?.systems?.loop?.start === 'function',
          },
        ];

        let results = '';
        let successCount = 0;

        checks.forEach(({ name, check }) => {
          try {
            const result = check();
            const status = result ? '‚úÖ' : '‚ùå';
            if (result) successCount++;
            results += `${status} ${name}: ${result ? 'Available' : 'Not Available'}<br>`;
          } catch (error) {
            results += `‚ùå ${name}: Error - ${error.message}<br>`;
          }
        });

        const overallStatus =
          successCount === checks.length
            ? 'success'
            : successCount > checks.length / 2
              ? 'warning'
              : 'error';

        addStatus(
          'system-status',
          `Overall Status: ${successCount}/${checks.length} systems available<br><br>${results}`,
          overallStatus
        );
      }

      function testSodaClick() {
        console.log('üçπ Testing soda click functionality...');

        if (typeof window.App?.systems?.clicks?.handleSodaClick === 'function') {
          try {
            window.App.systems.clicks.handleSodaClick(1);
            console.log('‚úÖ Soda click test successful');
            addStatus('system-status', '‚úÖ Soda click test successful', 'success');
          } catch (error) {
            console.error('‚ùå Soda click test failed:', error);
            addStatus('system-status', `‚ùå Soda click test failed: ${error.message}`, 'error');
          }
        } else {
          console.error('‚ùå handleSodaClick function not available');
          addStatus('system-status', '‚ùå handleSodaClick function not available', 'error');
        }
      }

      function testTabSwitching() {
        console.log('üîÑ Testing tab switching functionality...');

        if (typeof window.App?.ui?.switchTab === 'function') {
          try {
            // Test switching to stats tab
            window.App.ui.switchTab('stats', {
              target: document.querySelector('[data-action="switchTab:stats"]'),
            });
            console.log('‚úÖ Tab switching test successful');
            addStatus('system-status', '‚úÖ Tab switching test successful', 'success');
          } catch (error) {
            console.error('‚ùå Tab switching test failed:', error);
            addStatus('system-status', `‚ùå Tab switching test failed: ${error.message}`, 'error');
          }
        } else {
          console.error('‚ùå switchTab function not available');
          addStatus('system-status', '‚ùå switchTab function not available', 'error');
        }
      }

      function testButtonSystem() {
        console.log('üîò Testing button system...');

        if (typeof window.App?.ui?.initButtonSystem === 'function') {
          try {
            window.App.ui.initButtonSystem();
            console.log('‚úÖ Button system test successful');
            addStatus('system-status', '‚úÖ Button system test successful', 'success');
          } catch (error) {
            console.error('‚ùå Button system test failed:', error);
            addStatus('system-status', `‚ùå Button system test failed: ${error.message}`, 'error');
          }
        } else {
          console.error('‚ùå Button system not available');
          addStatus('system-status', '‚ùå Button system not available', 'error');
        }
      }

      function testGameLoop() {
        console.log('üîÑ Testing game loop...');

        if (typeof window.App?.systems?.loop?.start === 'function') {
          try {
            window.App.systems.loop.start({
              updateDrinkProgress: () => console.log('Drink progress updated'),
              processDrink: () => console.log('Drink processed'),
              updateStats: () => console.log('Stats updated'),
              updatePlayTime: () => console.log('Play time updated'),
              updateLastSaveTime: () => console.log('Last save time updated'),
            });
            console.log('‚úÖ Game loop test successful');
            addStatus('system-status', '‚úÖ Game loop test successful', 'success');
          } catch (error) {
            console.error('‚ùå Game loop test failed:', error);
            addStatus('system-status', `‚ùå Game loop test failed: ${error.message}`, 'error');
          }
        } else {
          console.error('‚ùå Game loop not available');
          addStatus('system-status', '‚ùå Game loop not available', 'error');
        }
      }

      function updateGameStats() {
        console.log('üìä Updating game statistics...');

        const statsContainer = document.getElementById('game-stats');
        const stats = [
          { name: 'Sips', value: window.App?.state?.getState?.()?.sips || 0 },
          { name: 'Straws', value: window.App?.state?.getState?.()?.straws || 0 },
          { name: 'Cups', value: window.App?.state?.getState?.()?.cups || 0 },
          { name: 'Level', value: window.App?.state?.getState?.()?.level || 1 },
          { name: 'Drink Rate', value: window.App?.state?.getState?.()?.drinkRate || 5000 },
          { name: 'Drink Progress', value: window.App?.state?.getState?.()?.drinkProgress || 0 },
        ];

        statsContainer.innerHTML = stats
          .map(
            stat =>
              `<div class="stat-item">
                    <strong>${stat.name}:</strong> ${stat.value}
                </div>`
          )
          .join('');

        console.log('‚úÖ Game statistics updated');
      }

      function clearConsole() {
        document.getElementById('console-output').innerHTML = '';
      }

      // Initialize tab switching for this test page
      document.addEventListener('click', e => {
        const target = e.target;
        if (target.classList.contains('tab-btn')) {
          const action = target.getAttribute('data-action');
          if (action && action.startsWith('switchTab:')) {
            const tabName = action.split(':')[1];

            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            target.classList.add('active');

            // Update tab content
            document
              .querySelectorAll('.tab-content')
              .forEach(content => content.classList.remove('active'));
            const selectedTab = document.getElementById(`${tabName}Tab`);
            if (selectedTab) {
              selectedTab.classList.add('active');
            }

            console.log(`üîÑ Switched to ${tabName} tab`);
          }
        }
      });

      // Auto-run system check on load
      window.addEventListener('load', () => {
        setTimeout(checkSystemStatus, 1000);
        setTimeout(updateGameStats, 1500);
      });

      // Expose functions globally
      window.testSodaClick = testSodaClick;
      window.testTabSwitching = testTabSwitching;
      window.testButtonSystem = testButtonSystem;
      window.testGameLoop = testGameLoop;
      window.updateGameStats = updateGameStats;
      window.checkSystemStatus = checkSystemStatus;
    </script>
  </body>
</html>
