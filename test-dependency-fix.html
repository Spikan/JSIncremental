<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dependency Fix Test</title>
</head>
<body>
    <h1>Dependency Fix Test - Comprehensive Resolution</h1>
    <div id="results"></div>
    
    <script>
        // Test if our dependency fixes are working
        const results = document.getElementById('results');
        
        function testDependency(name, checkFn) {
            try {
                if (checkFn()) {
                    return `<div style="color: green;">‚úÖ ${name} is available</div>`;
                } else {
                    return `<div style="color: blue;">‚ÑπÔ∏è ${name} is not available yet (may load later)</div>`;
                }
            } catch (error) {
                return `<div style="color: red;">‚ùå Error checking ${name}: ${error.message}</div>`;
            }
        }
        
        // Test all the dependencies that were causing issues
        const dependenciesToTest = [
            {
                name: 'FEATURE_UNLOCKS',
                check: () => typeof FEATURE_UNLOCKS !== 'undefined'
            },
            {
                name: 'DOM_CACHE',
                check: () => typeof DOM_CACHE !== 'undefined'
            },
            {
                name: 'GAME_CONFIG',
                check: () => typeof window.GAME_CONFIG !== 'undefined'
            },
            {
                name: 'Decimal',
                check: () => typeof Decimal !== 'undefined'
            },
            {
                name: 'App object',
                check: () => typeof window.App !== 'undefined'
            }
        ];
        
        let html = '<h2>Dependency Status:</h2>';
        dependenciesToTest.forEach(dep => {
            html += testDependency(dep.name, dep.check);
        });
        
        // Test if we can access the dependencies without errors
        html += '<h2>Dependency Access Test:</h2>';
        
        try {
            if (typeof FEATURE_UNLOCKS !== 'undefined') {
                html += '<div style="color: green;">‚úÖ FEATURE_UNLOCKS is accessible</div>';
                if (FEATURE_UNLOCKS.init) {
                    html += '<div style="color: green;">‚úÖ FEATURE_UNLOCKS.init method is available</div>';
                } else {
                    html += '<div style="color: orange;">‚ö†Ô∏è FEATURE_UNLOCKS.init method is NOT available</div>';
                }
            } else {
                html += '<div style="color: blue;">‚ÑπÔ∏è FEATURE_UNLOCKS is not accessible yet</div>';
            }
        } catch (error) {
            html += `<div style="color: red;">‚ùå Error accessing FEATURE_UNLOCKS: ${error.message}</div>`;
        }
        
        try {
            if (typeof DOM_CACHE !== 'undefined') {
                html += '<div style="color: green;">‚úÖ DOM_CACHE is accessible</div>';
                if (DOM_CACHE.init) {
                    html += '<div style="color: green;">‚úÖ DOM_CACHE.init method is available</div>';
                } else {
                    html += '<div style="color: orange;">‚ö†Ô∏è DOM_CACHE.init method is NOT available</div>';
                }
            } else {
                html += '<div style="color: blue;">‚ÑπÔ∏è DOM_CACHE is not accessible yet</div>';
            }
        } catch (error) {
            html += `<div style="color: red;">‚ùå Error accessing DOM_CACHE: ${error.message}</div>`;
        }
        
        // Test if there are any undefined reference errors
        html += '<h2>Undefined Reference Test:</h2>';
        
        try {
            // Test if we can call FEATURE_UNLOCKS methods without errors
            if (typeof FEATURE_UNLOCKS !== 'undefined') {
                try {
                    // Test a method call
                    if (FEATURE_UNLOCKS.checkAllUnlocks) {
                        html += '<div style="color: green;">‚úÖ FEATURE_UNLOCKS.checkAllUnlocks method is callable</div>';
                    } else {
                        html += '<div style="color: orange;">‚ö†Ô∏è FEATURE_UNLOCKS.checkAllUnlocks method is NOT available</div>';
                    }
                } catch (error) {
                    html += `<div style="color: red;">‚ùå Error calling FEATURE_UNLOCKS method: ${error.message}</div>`;
                }
            } else {
                html += '<div style="color: blue;">‚ÑπÔ∏è FEATURE_UNLOCKS not available for method testing</div>';
            }
        } catch (error) {
            html += `<div style="color: red;">‚ùå Error in undefined reference test: ${error.message}</div>`;
        }
        
        // Test script loading order
        html += '<h2>Script Loading Order Test:</h2>';
        
        const scripts = document.querySelectorAll('script[src]');
        const scriptOrder = [];
        scripts.forEach(script => {
            if (script.src.includes('js/')) {
                scriptOrder.push(script.src.split('/').pop());
            }
        });
        
        html += '<div style="color: blue;">‚ÑπÔ∏è Scripts loaded in this order:</div>';
        scriptOrder.forEach((script, index) => {
            html += `<div style="color: blue;">&nbsp;&nbsp;${index + 1}. ${script}</div>`;
        });
        
        results.innerHTML = html;
        
        // Auto-refresh to show dependency loading progress
        let refreshCount = 0;
        const maxRefreshes = 10;
        
        function autoRefresh() {
            if (refreshCount < maxRefreshes) {
                refreshCount++;
                setTimeout(() => {
                    location.reload();
                }, 2000);
            }
        }
        
        // Start auto-refresh if dependencies aren't ready
        if (dependenciesToTest.some(dep => !dep.check())) {
            html += '<div style="color: orange;">üîÑ Auto-refreshing in 2 seconds to show dependency loading progress...</div>';
            results.innerHTML = html;
            autoRefresh();
        }
    </script>
</body>
</html>